Скрипт для мониторинга S.M.A.R.T USB-диска на asus rt-n56u
==========================================================

Описание
--------

Скрипт мониторит smart подключенного диска(ов) к роутеру rt-n56u
 
- Отображает данные на http://my.router/custom/smart.html
- Пишет в лог о критических событиях. Может отсылать уведомления на почту с ящика gmail.


asus rt-n56u должен работать на прошивке `Padavan <https://bitbucket.org/padavan/rt-n56u>`_


Изменения
---------

Измененная версия с http://wl500g.info/showthread.php?26346&langid=3&p=269490#post269490

 - Работает отправка с gmail
 - html перенесено в custom
 - Исправлено отображение картинок

Настройка
---------

Перед использованием требуется настроить `Entware 
<https://bitbucket.org/padavan/rt-n56u/wiki/RU/%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20Entware>`_


Скрипт получает данные из вывода smartctl, сравнивает их с сохранёнными значениями предыдущей проверки и создаёт html-страницу (/opt/share/www/custom/smart.html) с таблицей атрибутов, отображая в ней последние изменения параметров. Также пишет в лог при изменении критически важных атрибутов и может отсылать сообщение по e-mail (sendmail). Опционально использует rrdtool для графика температуры (вообще, скрипт позволяет создавать rrd-графики для любых SMART-атрибутов, но, ИМХО, практический смысл имеет лишь температура). Для RRD присутствуют несколько вариантов пресетов создания баз, в зависимости от интервала обновления данных. Скрипт полностью совместим с ash и awk из busybox.
Перед началом использования, естественно, необходимо установить smartmontools и rrdtool из Entware::

  opkg install smartmontools rrdtool

Сам скрипт нужно положить, к примеру, в /opt/usr/bin/smarthtml.sh (после этого не забыв: chmod +x /opt/usr/bin/smarthtml.sh). Затем добавить в cron для регулярного запуска... По умолчанию база rrd создаётся с шагом в 3 часа, а следовательно::

  10 */3 * * * /opt/usr/bin/smarthtml.sh

При первом запуске скрипт сам создаст каталог /opt/var/smarthtml/ и необходимые файлы для работы.

Параметры вызова::


 /opt/usr/bin/smarthtml.sh              # запуск основной процедуры выполнения (запускается cron'ом по расписанию)
 /opt/usr/bin/smarthtml.sh resetwarn    # сброс предупреждения после изменения критического параметра
 /opt/usr/bin/smarthtml.sh resetcount   # сброс счётчиков изменений параметров
 /opt/usr/bin/smarthtml.sh makerrdgraph # только отрисовка графиков rrd без проверки SMART и без изменения данных
 /opt/usr/bin/smarthtml.sh mailtest     # отправка тестового email (в случае использования e-mail оповещений)



Для отправки почты необходимо установить USE_MAIL=1 в скрипте и задать почтовые ящики и пароль.

cgi-модуль не настраивал